<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>D-CASE VIEWER</title>
<link rel="stylesheet" type="text/css" href="lib/codemirror.css"/>
<link rel="stylesheet" type="text/css" href="lib/jquery.svg.css"/>
<link rel="stylesheet" type="text/css" href="lib/bootstrap.icons.css"/>
<link rel="stylesheet" type="text/css" href="css/dcase-node.css"/>
<link rel="stylesheet" type="text/css" href="css/viewer.css"/>
<link rel="stylesheet" type="text/css" href="css/sidemenu.css"/>
<link rel="stylesheet" type="text/css" href="css/edit.css"/>
<link rel="stylesheet" type="text/css" href="css/timeline.css"/>
<style>
body {
	min-height: 480px;
	margin: 0px;
}
#viewer {
	left: 0px;
	top : 0px;
	width : 100%;
	height: 100%;
}
</style>
<script type="text/javascript" src="lib/jquery.min.js"></script>
<script type="text/javascript" src="lib/jquery.mousewheel.min.js"></script>
<script type="text/javascript" src="lib/jquery.svg.min.js"></script>
<script type="text/javascript" src="lib/jquery.svganim.min.js"></script>
<script type="text/javascript" src="lib/codemirror.js"></script>
<script type="text/javascript" src="lib/storyjs-embed.js"></script>
<script type="text/javascript" src="js/dcaseviewer.js"></script>
<script type="text/javascript" src="js/dnode.js"></script>
<script type="text/javascript" src="js/dnodeview.js"></script>
<script type="text/javascript" src="js/handler.js"></script>
<script type="text/javascript" src="js/edit.js"></script>
<script type="text/javascript" src="js/sidemenu.js"></script>
<script type="text/javascript" src="js/api.js"></script>
<script type="text/javascript" src="js/animation.js"></script>
<script type="text/javascript" src="js/operation.js"></script>
<script type="text/javascript">

function getNodeFromServer() {
	var args = DCaseAPI.call("getArgumentList", {});
	var tree = DCaseAPI.call("getNodeTree", { BelongedArgumentId: args.id[0]});
	var node = createNodeFromJson(tree.Tree);
	return node;
}

window.addEventListener("load",function() {
	//var node = createSampleNode();
	var node = getNodeFromServer();
	var opts = {
		argument_id: "1",//FIXME
	};
	var viewer = new DCaseViewer(document.getElementById("viewer"), node, opts);
	var menu = new SideMenu(document.body, viewer);

	$(".tool-new").click(function() {
		menu.actInsertToSelectedNode();
	});
	$(".tool-edit").click(function() {
		menu.actEditSelectedNode();
	});
	$(".tool-remove").click(function() {
		menu.actRemoveSelectedNode();
	});
	$(".tool-left").click(function() {
		viewer.prevVersion(viewer.getSelectedNode());
	});
	$(".tool-right").click(function() {
		viewer.nextVersion(viewer.getSelectedNode());
	});
	$(".tool-up").click(function() {
		viewer.actExpandBranch(viewer.getSelectedNode(), false);
		$(".tool-up").css("display", "none");
		$(".tool-down").css("display", "inline");
	});
	$(".tool-down").click(function() {
		viewer.actExpandBranch(viewer.getSelectedNode(), true);
		$(".tool-up").css("display", "inline");
		$(".tool-down").css("display", "none");
	});

	$(".tool-play").click(function() {
		var v = viewer.getSelectedNode();
		viewer.showDScriptExecuteWindow(v.node.getDScriptNameInEvidence());
	});

	var timeline =  {
		"headline":"The Main Timeline Headline Goes here",
		"type":"default",
		"text":"",
		"asset": {
			"credit":"Credit Name Goes Here",
			"caption":"Caption text goes here"
		},
		"date": [
			{
				"startDate":"2011,12,10",
				"endDate":"2011,12,11",
				"headline":"Commit 2",
				"text":"<p>Body text goes here, some HTML is OK</p>",
				"asset": {
					"credit":"Credit Name Goes Here",
					"caption":"Caption text goes here"
			}},
			{
				"startDate":"2011,10,10",
				"endDate":"2011,10,11",
				"headline":"Commit 1",
				"text":"<p>Body text goes here, some HTML is OK</p>",
				"asset": {
					"credit":"Credit Name Goes Here",
					"caption":"Caption text goes here"
			}},
		],
	};

	createStoryJS({
		type    : "timeline",
		width   : '95%',
		height  : '240',
		source  : { timeline: timeline},
		embed_id: 'timeline-embed',
		//lang    : 'ja',
		css     : 'lib/timeline.css',
		js      : 'lib/timeline-min.js'
	});

	// hide url bar for ipod touch
	setTimeout(function(){
		window.scrollTo(0, 0);
	}, 0);
});
</script>
</head>
<body>
<svg width="0" height="0">
<defs>
	<marker id="Triangle-black" viewBox="0 0 10 10" refX="10" refY="5"
		markerUnits="strokeWidth" markerWidth="15" markerHeight="9" orient="auto">
		<path d="M 0 0 L 10 5 L 0 10 z" fill="gray" stroke="gray"/>
	</marker>
	<marker id="Triangle-white" viewBox="0 0 10 10" refX="10" refY="5"
		markerUnits="strokeWidth" markerWidth="15" markerHeight="9" orient="auto">
		<path d="M 0 0 L 10 5 L 0 10 z" fill="white" stroke="gray"/>
	</marker>
</defs>
</svg>

<div id="viewer"></div>

<div id="toolbar" style="display: none;">
	<a href="#" class="tool-new"><i class="icon-plus"></i></a>
	<a href="#" class="tool-remove"><i class="icon-remove"></i></a>
	<a href="#" class="tool-left"><i class="icon-arrow-left"></i></a>
	<a href="#" class="tool-right"><i class="icon-arrow-right"></i></a>
	<a href="#" class="tool-play"><i class="icon-play"></i></a>
	<a href="#" class="tool-up"><i class="icon-circle-arrow-up"></i></a>
	<a href="#" class="tool-down"><i class="icon-circle-arrow-down"></i></a>
</div>

<div id="menu">
	<div id="menu-search-i" class="menu-i" style="left: 0px;">
		<i class="icon-search"></i>
	</div>
	<div id="menu-search" class="menu-box">
		<input type="text"></input>
		<ul style="list-style-type: none; overflow: auto;"></ul>
	</div>

	<div id="menu-export-i" class="menu-i" style="left: 40px;">
		<i class="icon-download"></i>
	</div>
	<div id="menu-export" class="menu-box">
		<input id="menu-export-json" type="button" value="export json"></input>
		<input id="menu-export-png"  type="button" value="export png"></input>
		<input id="menu-export-script"  type="button" value="export script"></input>
	</div>

	<div id="menu-info-i" class="menu-i" style="left: 80px;">
		<i class="icon-info-sign"></i>
	</div>
	<div id="menu-info" class="menu-box">
		<table id="menu-info-table"></table>
	</div>

	<div id="menu-tool-i" class="menu-i" style="left: 120px;">
		<i class="icon-list"></i>
	</div>
	<div id="menu-tool" class="menu-box">
		<input id="menu-tool-commit" type="button" value="commit"></input>
		<input id="menu-tool-undo" type="button" value="undo"></input>
		<input id="menu-tool-redo" type="button" value="redo"></input>
	</div>

	<div id="menu-tool-i" class="menu-i" style="left: 160px;">
		<i class="icon-print"></i>
	</div>
</div>

<div id="edit">
	<h1>Type</h1>
	<select></select>
	<h1>Description</h1>
	<textarea rows=4 cols=40></textarea><br>
	<input id="edit-ok" type="button" value="OK"></input>
	<input id="edit-cancel"type="button" value="Cancel"></input>
</div>

<div id="timeline-embed" style="position: absolute; bottom: 0px; margin: 0px;"></div>

</body>
</html>
